<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>闲客&#39;Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="闲客&#39;Blog">
<meta property="og:url" content="http://xianke5200.github.io/page/2/index.html">
<meta property="og:site_name" content="闲客&#39;Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xianke5200">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="闲客&#39;Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
<meta name="generator" content="Hexo 5.2.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<!--人体时钟背景透明-->
	<script charset="Shift_JIS" src="http://chabudai.sakura.ne.jp/blogparts/honehoneclock/honehone_clock_tr.js"></script>

    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate"></a></h1>
        </hgroup>

        
        !<p class="header-subtitle">业精于勤荒于嬉， 行成于思毁于随</p>
		<div id="binft"></div>
			<script>
				var binft = function (r) {
				    function t() {
						return b[Math.floor(Math.random() * b.length)]
				    }  
				    function e() {
						return String.fromCharCode(94 * Math.random() + 33)
				    }
				    function n(r) {
						for (var n = document.createDocumentFragment(), i = 0; r > i; i++) {
						    var l = document.createElement("span");
						    l.textContent = e(), l.style.color = t(), n.appendChild(l)
					    }
					    return n
				    }
				    function i() {
						var t = o[c.skillI];
						c.step ? c.step-- : (c.step = g, c.prefixP < l.length ? (c.prefixP >= 0 && (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP < t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP > 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP < l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d)
				    }
				    var l = "",
				    o = [theme.subtitle].map(function (r) {
				    return r + ""
				    }),
				    a = 2,
				    g = 1,
				    s = 5,
				    d = 75,
				    b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"],
				    c = {
						text: "",
						prefixP: -s,
						skillI: 0,
						skillP: 0,
						direction: "forward",
						delay: a,
						step: g
				    };
				    i()
				};
				binft(document.getElementById('binft'));
			</script>

        
        
            <form>
                <input type="text" class="st-default-search-input search" id="search" placeholder=" Search...">
            </form>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github" target="_blank" href="https://github.com/xianke5200" title="github">github</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/test/" style="font-size: 10px;">test</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://xianke5200.github.io/">xianke5200</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">个人博客记录</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me"></a></h1>
            </hgroup>
            
            <p class="header-subtitle">业精于勤荒于嬉， 行成于思毁于随</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://github.com/xianke5200" title="github">github</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-关于提升仿动态图显示速度的一点想法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/06/27/%E5%85%B3%E4%BA%8E%E6%8F%90%E5%8D%87%E4%BB%BF%E5%8A%A8%E6%80%81%E5%9B%BE%E6%98%BE%E7%A4%BA%E9%80%9F%E5%BA%A6%E7%9A%84%E4%B8%80%E7%82%B9%E6%83%B3%E6%B3%95/" class="article-date">
      <time datetime="2019-06-27T09:18:49.000Z" itemprop="datePublished">2019-06-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/27/%E5%85%B3%E4%BA%8E%E6%8F%90%E5%8D%87%E4%BB%BF%E5%8A%A8%E6%80%81%E5%9B%BE%E6%98%BE%E7%A4%BA%E9%80%9F%E5%BA%A6%E7%9A%84%E4%B8%80%E7%82%B9%E6%83%B3%E6%B3%95/">关于提升仿动态图显示速度的一点想法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>典型的BMP图像文件由四部分组成：<br>1：位图头文件数据结构，它包含BMP图像文件的类型、显示内容等信息；<br>2：位图信息数据结构，它包含有BMP图像的宽、高、压缩方法，以及定义颜色等信息；<br>3：调色板，这个部分是可选的，有些位图需要调色板，有些位图，比如真彩色图（24位的BMP）就不需要调色板；<br>4：位图数据，这部分的内容根据BMP位图使用的位数不同而不同，在24位图中直接使用RGB，而其他的小于24位的使用调色板中颜色索引值。<br>其中位图文件数据结构为14个字节，结构组成如下：<br>typedef struct tagBITMAPFILEHEADER<br>{<br>WORD bfType;//位图文件的类型，必须为BM(1-2字节）<br>DWORD bfSize;//位图文件的大小，以字节为单位（3-6字节，低位在前）<br>WORD bfReserved1;//位图文件保留字，必须为0(7-8字节）<br>WORD bfReserved2;//位图文件保留字，必须为0(9-10字节）<br>DWORD bfOffBits;//位图数据的起始位置，以相对于位图（11-14字节，低位在前）<br>//文件头的偏移量表示，以字节为单位<br>}attribute((packed)) BITMAPFILEHEADER;<br>在32位MCU中要注意字节对齐，否则读取出来的数据可能会对不上，该结构体中的bfsize元素，代表的是整个bmp文件的大小，也就是bmp文件4个部分的总大小。<br>位图信息数据结构位40个字节，结构组成如下：<br>typedef struct tagBITMAPINFOHEADER<br>{<br>DWORD biSize;//本结构所占用字节数（15-18字节）<br>LONG biWidth;//位图的宽度，以像素为单位（19-22字节）<br>LONG biHeight;//位图的高度，以像素为单位（23-26字节）<br>WORD biPlanes;//目标设备的级别，必须为1(27-28字节）<br>WORD biBitCount;//每个像素所需的位数，必须是1（双色），（29-30字节）<br>//4(16色），8(256色）16(高彩色)或24（真彩色）之一<br>DWORD biCompression;//位图压缩类型，必须是0（不压缩），（31-34字节）<br>//1(BI_RLE8压缩类型）或2(BI_RLE4压缩类型）之一<br>DWORD biSizeImage;//位图的大小(其中包含了为了补齐行数是4的倍数而添加的空字节)，以字节为单位（35-38字节）<br>LONG biXPelsPerMeter;//位图水平分辨率，每米像素数（39-42字节）<br>LONG biYPelsPerMeter;//位图垂直分辨率，每米像素数（43-46字节)<br>DWORD biClrUsed;//位图实际使用的颜色表中的颜色数（47-50字节）<br>DWORD biClrImportant;//位图显示过程中重要的颜色数（51-54字节）<br>}attribute((packed)) BITMAPINFOHEADER;<br>有颜色表的bmp文件中，颜色表的大小一般位16个字节。<br>位图数据：<br>         一般位图数据的记录顺序是从左到右，从下到上，所以图片的有效数据是倒着存储的，也就是第一行的数据一般在文件的最末尾，最后一行数据在文件的颜色表的后面，所以当我们调用ucgui的显示函数画图时，uigui的内部函数是，从文件底部数据开始一行一行的读取，然后显示在屏幕上，但是这样速度会比较慢；而且图片数据是以四字节对齐的，而且当图片的宽度为奇数，图片数据每行后面补零，保证数据是四字节对齐，这时ucgui内部会对这些补齐的数据进行处理，这同样会造成时间的浪费。<br>         我们可以自己编写一个读取函数，先读取两个文件结构的信息，得到每帧bmp图片的大小，宽度，高度，数据偏移量，然后再根据数据偏移量读取图片有效数据，这时我们可以一次读取多行数据，因为每行数据量是相等的，所以我们也很容易对补零的数据进行处理，这样就可以显著提升仿动态图的显示效果，防止刷屏水纹的出现。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/GUI/">GUI</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-软件QSPI调试" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/20/%E8%BD%AF%E4%BB%B6QSPI%E8%B0%83%E8%AF%95/" class="article-date">
      <time datetime="2019-05-20T10:29:27.000Z" itemprop="datePublished">2019-05-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/20/%E8%BD%AF%E4%BB%B6QSPI%E8%B0%83%E8%AF%95/">软件QSPI调试</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>  相对于spi，qspi的是四条数据线并行传输数据，读写速度是普通spi的四倍。spi的工作模式有四种，但是qspi的工作模式只有两种也就是模式0（CPOL=0,CPOH=1）和模式3（CPOL=1,CPOL=1）.<br>  在使用软件qspi前，需要先使能对应芯片的qspi功能，一般是先读取使能位的状态寄存器，根据状态寄存器的qspi状态位判断该芯片当前是否已开启qspi，qspi与普通spi不能同时使用，在同一时刻只能有一种起作用。在qspi功能未开启前，需要先通过普通spi功能，来读写qspi使能状态位，开启qspi的功能。在通过普通spi读写状态寄存器时，需要先将hold和wp两个对应的io口拉高，来保证数据的有效传输。<br>  在使用普通spi或者qspi读写的可以通过直接操作寄存器的方式来优化程序的执行速度。<br>  在编写读写函数时要注意时序的问题，模式0：没有读写操作时，CLK引脚拉低，在时钟线的第一个边沿读写数据。<br>                                                                  模式1：没有读写操作时，CLK引脚拉高，在时钟线的第二个边沿读写数据。</p>
<pre><code>  __INLINE ret_code_t gpio_spi_drv_xfer(uint8_t *ptx_buf, uint16_t tx_length, uint8_t *prx_buf, uint16_t rx_length)
&#123;

ret_code_t ret = NRF_SUCCESS;
uint8_t *rx_temp = prx_buf;

GPIO_CS_LOW;

if (tx_length)
&#123;
    for(int i = 0; i &lt; tx_length; i++)
    &#123;
        uint8_t tx_temp = ptx_buf[i];
        for(int j = 0; j &lt; 8; j++)
        &#123;
            GPIO_CLK_LOW;

            if(tx_temp &amp; 0x80)
            &#123;
                GPIO_SPI_MOSI_HIGH;
            &#125;
            else
            &#123;
                GPIO_SPI_MOSI_LOW;
            &#125;
            tx_temp &lt;&lt;= 1;
            GPIO_CLK_HIGH;

        &#125;
    &#125;
&#125;

if (rx_length)
&#123;        
    for(int i = 0; i &lt; rx_length; i++)
    &#123;
    #if (MISO_PIN != 0XFF)
        for(unsigned char j = 0; j &lt; 8; j++)
        &#123;
            GPIO_CLK_LOW;
            GPIO_CLK_HIGH;
            rx_temp[i] &lt;&lt;= 1;
            if(GPIO_SPI_MISO)
            &#123;
                rx_temp[i]++;
            &#125;
        &#125;
    #endif
    &#125;
&#125;

GPIO_CS_HIGH;
return ret;
&#125;

__INLINE ret_code_t gpio_qspi_drv_xfer(uint8_t *ptx_buf, uint16_t tx_length, uint8_t *prx_buf, uint16_t rx_length)
&#123;
ret_code_t ret = NRF_SUCCESS;
uint8_t *rx_temp = prx_buf;
QSPI_LOCK();
GPIO_CS_LOW;

//qspi_drv_set_output();
if (tx_length &gt; 0)
&#123;
    QSPI_DRV_SET_OUTPUT(0xf0);// set pin (28-31) dir to output
    int size = tx_length;
    uint8_t byte_reg = 0;
    for(int i = 0; i &lt; size; i++)
    &#123;
        uint8_t tx_temp = (ptx_buf[i] &gt;&gt; 4) &amp; 0x0f;

        GPIO_CLK_LOW;
        //qspi_drv_write_data(tx_temp);
        byte_reg = QSPI_READ_WRITE_REG();// get the pin (24 - 31) state
        QSPI_DRV_WRITE_DAT(((tx_temp&lt;&lt;4)&amp;0xf0) | (byte_reg&amp;0x0f));
        __nop();
        GPIO_CLK_HIGH;
        __nop();

        GPIO_CLK_LOW;
        //qspi_drv_write_data(ptx_buf[i]);
        byte_reg = QSPI_READ_WRITE_REG();
        QSPI_DRV_WRITE_DAT(((ptx_buf[i]&lt;&lt;4)&amp;0xf0) | (byte_reg&amp;0x0f));
        __nop();
        GPIO_CLK_HIGH;
        __nop();
    &#125;
    GPIO_CLK_HIGH;
&#125;

__disable_irq();
if (rx_length)
&#123;        
    //qspi_drv_set_intput();
    QSPI_DRV_SET_INPUT(0xf0);
    for(int i = 0; i &lt; rx_length; i++)
    &#123;    
        GPIO_CLK_LOW;
        __nop();__nop();__nop();
        GPIO_CLK_HIGH;
        rx_temp[i] = QSPI_DRV_READ_DAT();
        __nop();

        rx_temp[i] = rx_temp[i] &amp; 0xf0;
        GPIO_CLK_LOW;
        __nop();__nop();__nop();
        GPIO_CLK_HIGH;
        rx_temp[i] |= (QSPI_DRV_READ_DAT() &gt;&gt; 4);
        __nop();
    &#125;
    GPIO_CLK_HIGH;
&#125;
__enable_irq();
GPIO_CS_HIGH;
QSPI_UNLOCK();
return ret;
&#125;</code></pre>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/%E9%A9%B1%E5%8A%A8/">驱动</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-csr8610调试小结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/12/21/csr8610%E8%B0%83%E8%AF%95%E5%B0%8F%E7%BB%93/" class="article-date">
      <time datetime="2018-12-21T09:08:55.000Z" itemprop="datePublished">2018-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/21/csr8610%E8%B0%83%E8%AF%95%E5%B0%8F%E7%BB%93/">csr8610调试小结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>  为了调试CSR8610调通，把自己折腾的简直怀疑人生，花费了两个星期，总算是调好了，所以来唠叨两句。<br>  首先先列举一下csr官方的两个工具，一个config tool，编辑自己的配置文件，一个ps tool，烧录工具。<br>  利用csr8610实现的功能比较简单，因为博主比较渣，所以尽管是简单的东西，还是折腾的够呛；接下来说说<br>调试的时候遇到的一些bug，首先是得到蓝牙的连接状态，可以通过读取led事件，得到连接状态，虽然<br>8610固件内部会自动向我们配置的io口输出状态，配置io利用<br>config tool即可，<img src="https://img-blog.csdnimg.cn/20181214182323389.png" alt="在config tool工具的input/output配置项中配置即可"><br>后来发现这几个状态都不是连接状态，想从按键事件事件中得到也不可行。从led得到连接状态的具体配置参看如下：<br><img src="https://img-blog.csdnimg.cn/20181214182848191.png" alt="主要就是这三个配置项"><br>LEDs state：因为我只想得到连接状态，所以我把里面的所有项全都移除了，不移除是否会有影响还需验证。<br>LEDs event：<br><img src="https://img-blog.csdnimg.cn/20181214183015218.png" alt="在这里插入图片描述"><br>LEDs filter：<br><img src="https://img-blog.csdnimg.cn/2018121418305228.png" alt="在这里插入图片描述"><br>后面的LED 0，可以配置成其它项，只要程序上相对应即可。<br>有几点需要注意一下<br>如果使用的8610上的io大于12，那么就需要通过config tool工具map成gpio<br><img src="https://img-blog.csdnimg.cn/20181221172052328.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzMzMzIzNTQ0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>csr8610默认会输出一些状态，io口也可以随意配置，不过这是要注意io口输出的电平，因为8610中有些io口默认输出的电平为1.8V，当然也可以改变硬件电路来使输出电平达到3.3V，相应功耗也会变高。<br><img src="https://img-blog.csdnimg.cn/20181221172211458.png" alt="VDD_PADS接3.3V可以使8610 pio输出3.3v"><br>还有一点就是注意io口的相互影响，这个主要事配置文件要配置正确，之前调试的时候就遇到过这种情况，配置文件没有配置正确，通过控制io电平使8610从连接状态进入配对状态时，8610对指令不响应。出现这种情况的原因，可能是由于我主控芯片上多个io口和8610相连接，但是实际用到的控制io没有那么多，而且也没有通过config tool工具对这些io进行配置，从而导致io口相互影响，指令失效的问题。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/CSR8610/">CSR8610</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Xmodem协议" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/12/Xmodem%E5%8D%8F%E8%AE%AE/" class="article-date">
      <time datetime="2018-11-12T09:21:00.000Z" itemprop="datePublished">2018-11-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/12/Xmodem%E5%8D%8F%E8%AE%AE/">Xmodem协议</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>   串行通信的文件传输协议主要有：Xmodem、Ymodem、Zmodem和KERMIT等。<br>   Xmodem协议一般支持128字节数据包，并且一般支持校验和、CRC两种校验方式，在出现数据包错误的情况下支持多次重传（一般为10次）。Xmodem协议传输有接收程序和发送程序完成，先由接收程序发送协商字符，协商校验方式，协商通过之后发送程序就开始发送数据包，接收程序接收到完整的一个数据包之后按照协商的方式对数据包进行校验。校验通过之后发送确认字符，然后发送程序继续发送下一包；如果校验失败，则发送否认字符，发送程序重传此数据包。<br>    定义：<br>    SOH    01H（modem数据头）<br>    EOT    04H（发送结束）<br>    ACK    06H（应答）<br>    NAK    15H（非应答）<br>    CAN    18H（取消发送）<br>    Xmodem数据包，包含一个标题开始字符，一个单字节包序号，一个包序号的补码，128字节数据和一个双字节的CRC校验。<br>    <img src="https://img-blog.csdnimg.cn/20181112170744164.png" alt="CRC校验信息包格式"><br>    1.校验和信息包：<br>    <img src="https://img-blog.csdnimg.cn/20181112170834209.png" alt="在这里插入图片描述"><br>    校验和方式传输流程：<br>        接收方要求发送方以校验和方式发送时以NAK来请求，发送方将对此做出应答。如下图：<br>        <img src="https://img-blog.csdnimg.cn/20181112171029363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzMzMzIzNTQ0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述">    <img src="https://img-blog.csdnimg.cn/20181112171044179.png" alt="在这里插入图片描述"><br>2.CRC校验信息包<br><img src="https://img-blog.csdnimg.cn/20181112171121839.png" alt="在这里插入图片描述"><br>计算16位CRC校验的除数多项式为X ^ 16 + X ^ 12 + X ^ 5 + 1，信息报中的128数据字节将参加CRC校验的计算，在发送端CRC16的高字节在前，低字节在后。<br>传输流程：接收方要求发送方以CRC校验方式发送时以‘C’来请求，发送方将对此作出应答。<br><img src="https://img-blog.csdnimg.cn/20181112171614997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzMzMzIzNTQ0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20181112171625558.png" alt="在这里插入图片描述"><br>信息报中如果生于的数据不足128字节，不足的部分将以0x1A填充。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">int32_t xmodem_download(uint32_t start_addr, uint32_t max_size, int *err)</span><br><span class="line">&#123;</span><br><span class="line">   xmodem_init();</span><br><span class="line">   xmodem_start();</span><br><span class="line"></span><br><span class="line">   while (1)</span><br><span class="line">   &#123;</span><br><span class="line">      int ret &#x3D; xmodem_getPacket();&#x2F;&#x2F;从串口得到数据，并校验</span><br><span class="line"></span><br><span class="line">      switch (ret)</span><br><span class="line">      &#123;</span><br><span class="line">         case XMODEM_DATA_OK:</span><br><span class="line">           sflash_write_data(start_addr, xbuf + 3, xmodem.packet_size);</span><br><span class="line">           start_addr +&#x3D; xmodem.packet_size;</span><br><span class="line">           xmodem.rcv_size +&#x3D; xmodem.packet_size;</span><br><span class="line">           xmodem.rcv_packet++;</span><br><span class="line">           if (xmodem.rcv_size &gt; max_size)</span><br><span class="line">           &#123;</span><br><span class="line">              xmodem_stop();</span><br><span class="line">              *err &#x3D; -2;</span><br><span class="line">              goto exit;</span><br><span class="line">           &#125;</span><br><span class="line">           xmodem_ack();</span><br><span class="line">         break;</span><br><span class="line"></span><br><span class="line">         case XMODEM_PKT_NUM_ERR:</span><br><span class="line">           xmodem_stop();</span><br><span class="line">           *err &#x3D; -3;</span><br><span class="line">           goto exit;</span><br><span class="line"></span><br><span class="line">         case XMODEM_CHECK_ERR:</span><br><span class="line">           xmodem_nack();</span><br><span class="line">         break;</span><br><span class="line"></span><br><span class="line">	     case XMODEM_DATA_REPEAT:</span><br><span class="line">	       xmodem_ack();</span><br><span class="line">	     break;</span><br><span class="line"></span><br><span class="line">         case XMODEM_EOT:</span><br><span class="line">           xmodem_ack();</span><br><span class="line">           PRINTF((&quot;\nXMODEM info  pkt: %d, size: %ld, chk: %s\n&quot;,</span><br><span class="line">                   xmodem.packet_size,</span><br><span class="line">                   xmodem.rcv_size,</span><br><span class="line">                   xmodem.chk_type &#x3D;&#x3D; XMODEM_CHECKSUM ? &quot;CHECKSUM&quot; : &quot;CRC16&quot;));</span><br><span class="line">           *err &#x3D; 0;</span><br><span class="line">	       goto exit;</span><br><span class="line"></span><br><span class="line">	     case XMODEM_CAN:</span><br><span class="line">	       xmodem_ack();</span><br><span class="line">	       *err &#x3D; -4;</span><br><span class="line">           goto exit;</span><br><span class="line"></span><br><span class="line">	     case XMODEM_SOH_ERR:</span><br><span class="line">	       xmodem_stop();</span><br><span class="line">	       *err &#x3D; -5;</span><br><span class="line">           goto exit;</span><br><span class="line"></span><br><span class="line">	     default: break;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">exit:</span><br><span class="line">   return xmodem.rcv_size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/%E9%A9%B1%E5%8A%A8/">驱动</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nrodic工具指令" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/09/nrodic%E5%B7%A5%E5%85%B7%E6%8C%87%E4%BB%A4/" class="article-date">
      <time datetime="2018-11-09T03:10:45.000Z" itemprop="datePublished">2018-11-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/09/nrodic%E5%B7%A5%E5%85%B7%E6%8C%87%E4%BB%A4/">nrodic工具指令</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>nrfutil的使用<br>命令<br>pkg命令： 这组命令用于生成DFU的包。<br>generate子命令： 生成一个（.zip）的包，后面可以通过手机APP或其它方式进行DFU的升级。<br>参数：<br>  –debug-mode： Debug模式切换，使能版本检查。<br>  –application TEXT： Application固件文件。<br>  –application-version INTEGER： Application固件的版本。<br>  –application-version-string TEXT： Application固件的版本字符串。<br>  –bootloader TEXT： Bootloader固件文件。<br>  –bootloader-version INTEGER： Bootloader固件的版本。<br>  –hw-version INTEGER： 硬件版本。<br>  –sd-id TEXT： 新的SoftDevice ID<br>  –softdevice TEXT： SoftDevice固件的文件。<br>  –key-file PATH： 提供的PEM格式的私有（签名的）Key。<br>  –help： 显示帮助。<br>  –sd-req TEXT： 兼容使用的SoftDevce，可以是一个或多个SoftDevice ID。<br>每个ID必须是2位或4位的HEX值，比如”0x12”, “0x1234”。<br>display子命令： 这个命令显示DFU包（.zip）的信息。</p>
<p>e.g.： nrfutil pkg display package.zip<br>dfu子命令： 这个命令可以通过串口、BLE或Thraed进行DFU更新。</p>
<p>ble参数： 通过BLE升级。<br>  -pkg，–package PATH： DFU包的文件名[必须]。<br>  -ic，–conn-ic-id [NRF51|NRF52]： 指明所使用的IC：NRF51或NRF52[必须]。<br>  -p，–port TEXT： 指定串口。<br>  -n，–name TEXT： 设备名。<br>  -a，–address TEXT： 蓝牙地址。<br>  -snr，–jlink_snr TEXT： Jlink序列号。<br>  -f，–flash_connectivity： 自动烧写connectivity固件。<br>  –help： 显示帮助。<br>ble示例： nrfutil dfu ble -ic NRF52 -pkg app_dfu_package.zip -p COM3 -n “MyDevice” -f<br>Thread参数： 通过Thread协议升级，不常用。<br>serial参数： 通过串口进行升级。<br>  -pkg，–package PATH： DFU包的文件名[必须]。<br>  -p，–port TEXT： 指定串口。<br>  -fc，–flow-control BOOLEAN： 使能流控这个值为1。<br>  -prn，–packet-receipt-notification INTEGER： Set the packet receipt notification value<br>  -b，–baud-rate INTEGER： 设置串口波特率。<br>  –help： 显示帮助。<br>serial示例： nrfutil dfu serial -pkg app_dfu_package.zip -p COM3 -b 115200<br>usb_serial示例： 与serial相同。<br>zigbee参数：通过zigbee升级。<br>    -f TEXT:zigbee升级镜像包文件名<br>    -snr INTEGER:序列号<br>    -chan INTEGER:通道号<br>生成zigbee升级包示例：nrfutil pkg generate –hw-version 52 –sd-req 0x00 –application-version 0x01020101<br>     –application app.hex –key-file key.pem app_dfu_package.zip –zigbee True –zigbeemanufacturer-id<br>    123 –zigbee-image-type 321 –zigbee-comment good_image<br>zigbee升级示例：nrfutil dfu zigbee -f CAFE-1234-good_image.zigbee -snr 683604699 -chan 20</p>
<p>keys子命令： 这个命令生成用于校验DFU包的加密密钥。<br> generate参数： 生成加密密钥，nrfutil keys generate private.pem<br> display参数： 显示加密文件的加密密钥。<br>  –key TEXT： （pk | sk）显示公钥（pk，public key），或私钥（sk，private key）。<br>  –format TEXT： （hex | code | pem）显示Key的格式：hex格式、C格式、PEM格式。<br>  –out_file TEXT： 输出保存的文件名。<br>  –help： 显示帮助。<br>settings子命令： 这个命令生成Bootloader DFU settings，必须烧写到Flash的最后一页。<br>  generate参数： 生成Bootloader DFU settings，这将生成一个hex文件。<br>  –family [NRF51 | NRF52 | NRF52QFAB | NRF52810 | NRF52840]： 指定IC。<br>  –application TEXT： 指定Application固件文件。<br>  –application-version INTEGER： Application固件的版本。<br>  –application-version-string TEXT： Application固件的版本字符串。<br>  –bootloader TEXT： Bootloader固件文件。<br>  –bootloader-version INTEGER： Bootloader固件的版本。<br>  –bl-settings-version INTEGER:    Bootloader setting 的版本<br>  –help： 显示帮助。<br>e.g:nrfutil settings generate –family NRF52 –application app.hex –<br>application-version 3 –bootloader-version 2 –bl-settings-version 1<br> settings.hex<br>display参数： 显示Bootloader DFU settings的hex文件的信息。<br>e.g.： nrfutil settings display flash_dump.hex</p>
<p>nrfjprog工具<br>    -family:指定IC<br>    -eraseall：将内部法拉盛全部擦除<br>    -erasepage startaddress - endaddress：擦除flash开始地址（startaddress）到结束地址（endaddress）部分<br>    -program：烧录<br>    -rpb：加密<br>    -reset：复位<br>示例<br>        nrfjprog –family NRF52 –eraseall<br>        #nrfjprog –family NRF52 –recover<br>        nrfjprog –family NRF52 –program .\APP-BL-Vx.xx.hex –reset<br>        #nrfjprog –family NRF52 –rbp ALL<br>mergehex工具<br>    -merge：合成多个文件为一个文件<br>    -output：输出目标文件<br>示例：mergehex –merge .\obj\APP-Release.hex .\S132-bootloader.hex .\dfu_settings.hex –output .\APP-BL-Vx.xx.hex<br>可以将多个.hex文件合并成一个文件，然后通过jlink烧录到设备中</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Nordic/">Nordic</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-emwin从外部flash中读取bmp图片显示" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/08/emwin%E4%BB%8E%E5%A4%96%E9%83%A8flash%E4%B8%AD%E8%AF%BB%E5%8F%96bmp%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA/" class="article-date">
      <time datetime="2018-11-08T07:15:17.000Z" itemprop="datePublished">2018-11-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/08/emwin%E4%BB%8E%E5%A4%96%E9%83%A8flash%E4%B8%AD%E8%AF%BB%E5%8F%96bmp%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA/">emwin从外部flash中读取bmp图片显示</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在emwin中有提供了一个从外部读取图片数据进行显示的函数，如下：<br><img src="https://img-blog.csdnimg.cn/20181108145438825.png" alt="在这里插入图片描述"><br>而且提供了官方例程，不过官方历程中从外部读取是从外部文件系统中进行读取的bmp图片进行显示，官方例程如下</p>
<pre><code>/*
*********************************************************************************************************
* 函 数 名: _GetData
* 功能说明: 被函数 GUI_BMP_DrawEx 调用
* 形 参： p FIL 类型数据
* NumBytesReq 请求读取的字节数
* ppData 数据指针
* Off 如果 Off = 1，那么将重新从起始位置读取
* 返 回 值: 返回读取的字节数
*********************************************************************************************************
*/
int _GetData(void * p, const U8 ** ppData, unsigned NumBytesReq, U32 Off)
&#123;
static int FileAddress = 0;
UINT NumBytesRead;
FIL *PicFile;
PicFile = (FIL *)p;
/*
* 检测缓存大小
*/
if (NumBytesReq &gt; sizeof(acBuffer)) &#123;
NumBytesReq = sizeof(acBuffer);
&#125;
/*
* 设置读取位置
*/
if(Off == 1) FileAddress = 0;
else FileAddress = Off;
result =f_lseek(PicFile, FileAddress);
/*
* 读取数据到缓存
*/
result = f_read(PicFile, acBuffer, NumBytesReq, &amp;NumBytesRead);

/*
* 让指针 ppData 指向读取的数据
*/
*ppData = (const U8 *)acBuffer;
/*
* 返回读取的字节数
*/
return NumBytesRead;
&#125;
/*
*********************************************************************************************************
* 函 数 名: _ShowBMP1
* 功能说明: 显示 BMP 图片
* 形 参: sFilename 要读取的文件名
* 返 回 值: 无
*********************************************************************************************************
*/
void _ShowBMP1(const char *sFilename)
&#123;
/* 打开文件 */
result = f_open(&amp;file, sFilename, FA_OPEN_EXISTING | FA_READ | FA_OPEN_ALWAYS);
if (result != FR_OK)
&#123;
return;
&#125;
/* 绘制 BMP 图片 */
GUI_BMP_DrawEx(_GetData, &amp;file, 0, 0);
/* 关闭文件 */
f_close(&amp;file);
&#125;</code></pre>
<p>关键部分就是从回调函数中读取bmp图片的数据。例程中时从外部文件按系统中进行读取，如果我们想从外部flash中直接读取的话，只需要在回调函数中对读取bmp数据部分进行简单修改就可以了</p>
<pre><code>/*
*********************************************************************************************************
* 函 数 名: _GetData
* 功能说明: 被函数 GUI_BMP_DrawEx 调用
* 形 参： p 图片参数
* NumBytesReq 请求读取的字节数
* ppData 数据指针
* Off 如果 Off = 1，那么将重新从起始位置读取
* 返 回 值: 返回读取的字节数
*********************************************************************************************************
*/
int _GetData(void * p, const U8 ** ppData, unsigned NumBytesReq, U32 Off)
&#123;
image_params_t *p_flash_pic= (image_params_t *)p;
if ((Off + NumBytesReq) &gt; p_flash_pic-&gt;size)
&#123;
    NRF_LOG_ERROR(&quot;Params error 0&quot;);
    NumBytesReq= p_flash_pic-&gt;size - Off;
&#125;
/*
* 检测缓存大小
*/
if (NumBytesReq &gt; sizeof(p_pic_buf)) &#123;
NumBytesReq = sizeof(p_pic_buf);
&#125;

/*
* 设置读取位置
*/
if(Off == 1) Off = 0;
else Off = Off;
//~~result =f_lseek(PicFile, FileAddress);~~ 
/*
*** 读取数据到缓存
*/
//~~result = f_read(PicFile, acBuffer, NumBytesReq, &amp;NumBytesRead);~~ 

/*
*GT24_FREE_FLASH_PIC_START_ADDR是flash中划分来存储bmp图片的起始地址，p_flash_pic-&gt;address是要显示的bmp图
*相对于GT24_FREE_FLASH_PIC_START_ADDR的偏移地址，是从回调函数中第一个参数传进来的
*/

uint32_t current_addr = GT24_FREE_FLASH_PIC_START_ADDR + p_flash_pic-&gt;address + (offset==1?0:offset);

 /*
*读取函数是自己创建的通过spi从flash读取指定字节大小的函数，这个可以根据自己的实际情况来定
*/

ret = gt24_read_nbytes(p_pic_buf, current_addr, NumBytesReq);**

/*
* 让指针 ppData 指向读取的数据
*/
*ppData = (const U8 *)p_pic_buf;


/*
* 返回读取的字节数
*/
return NumBytesReq;
&#125;
/*
*********************************************************************************************************
* 函 数 名: _ShowBMP1
* 功能说明: 显示 BMP 图片
* 形 参: sFilename 要读取的文件名
* 返 回 值: 无
*********************************************************************************************************
*/
void _ShowBMP1(void)
&#123;
/* 绘制 BMP 图片 ,file 是传进去的flash中的图片相关的参数，可以在Getdata中的第一个形参中得到*/
GUI_BMP_DrawEx(_GetData, &amp;file, 0, 0);
&#125;</code></pre>
<p>到这里，就完成了从外部flash中读取图片信息进行显示的整个过程了，除了从外部flash中读取bmp图片，还可以从外部flash中读取gif图片，也只需要将emwin提供的官方例程中的回调函数中的数据读取部分改为flash读取函数即可，同样要是想从外部flash中读取XBF字库文件，也是一样。<br>读取显示的流程：<br>1.制作图片数据bin文件，我在bin文件前面会保存每张图片的相关信息，包括图片大小，图片数据偏移量（图片在bin文件中的位置），图片名字；我用一个结构体来保存一张图片的上述数据；也就是说假如有5张图片，在bin的开始部分会保存5个包含图片信息的结构体，后面跟着的再是5张图片的完整数据（bmp头、信息头、颜色表（有的话）、图片有效数据）。<br>2.将bin文件写入flash中，方式有很多种，可以通过利用串口通过xmodem写入flash，也可以利用手机app通过蓝牙下发bin文件，写入flash中。<br>3.根据文件名遍历bin文件，每次读取一个结构体大小的数据量，直到找到相对应文件名的结构体，得到对应图片的相关信息，得到图片的名字、大小，以及偏移量（图片在bin文件中的位置），图片类型，这个结构体就是传入GUI_BMP_DrawEx函数的第二个形参，也就是getdata函数的第一个形参。<br>4.根据得到的图片相关信息，利用上述代码读取图片数据显示</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/GUI/">GUI</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-nrfgo studio 连接jlink，无法连接，recover时出现cannot find or open jlinkarm.dll" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/17/nrfgo%20studio%20%E8%BF%9E%E6%8E%A5jlink%EF%BC%8C%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%EF%BC%8Crecover%E6%97%B6%E5%87%BA%E7%8E%B0cannot%20find%20or%20open%20jlinkarm.dll/" class="article-date">
      <time datetime="2018-07-17T07:33:36.000Z" itemprop="datePublished">2018-07-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/17/nrfgo%20studio%20%E8%BF%9E%E6%8E%A5jlink%EF%BC%8C%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%EF%BC%8Crecover%E6%97%B6%E5%87%BA%E7%8E%B0cannot%20find%20or%20open%20jlinkarm.dll/">nrfgo studio 连接jlink，无法连接，recover时出现cannot find or open jlinkarm.dll</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>  这几天调试jlink时，突然无法使用jlink进行程序下载，一开始觉得是jlink的固件坏了，于是各种找资源，尝试多次，最后终于在sam-bav2.15版本上成功更换jlink固件，本以为这样问题就应该解决了，没想到插在电脑上一试，问题依旧；又觉得是系统路径不对，去注册表改路径，可进注册表一看，路径与安装路径完全一致，所以此法又不通；或许是自己软件安装方式不对，于是又屁颠屁颠的卸载重装N次，提示依旧，不见好转；<br>  正当束手无策，感慨天要亡我之际，无意之中打开安装的jlink驱动文件安装目录下的jlink.exe程序，发现该程序提示的jlink S/N号为-1，顿感此处定有异常，真是山重水复疑无路，柳暗花明又一村。<br><img src="https://img-blog.csdn.net/20180717154141425?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzMzMzIzNTQ0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>  在jlink.exe下执行“exec  setsn=XXXXXXXX”命令，其中XXXXXXXX就是新的S/N号，数字随意。<br>  <img src="https://img-blog.csdn.net/201807171543179?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzMzMzIzNTQ0/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"><br>  成功修改后，再次进入nrfgo studio，成功识别。<br>  为了解决这个问题，还是建议，先重新刷一下固件，然后再修改序列号。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/%E9%A9%B1%E5%8A%A8/">驱动</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-蓝牙基带与链路控制器协议" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/07/04/%E8%93%9D%E7%89%99%E5%9F%BA%E5%B8%A6%E4%B8%8E%E9%93%BE%E8%B7%AF%E6%8E%A7%E5%88%B6%E5%99%A8%E5%8D%8F%E8%AE%AE/" class="article-date">
      <time datetime="2018-07-04T13:52:39.000Z" itemprop="datePublished">2018-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/04/%E8%93%9D%E7%89%99%E5%9F%BA%E5%B8%A6%E4%B8%8E%E9%93%BE%E8%B7%AF%E6%8E%A7%E5%88%B6%E5%99%A8%E5%8D%8F%E8%AE%AE/">蓝牙基带与链路控制器协议</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#1蓝牙基带概述</p>
<p>蓝牙发送数据时基带部分将来自高层协议的数据进行信道编码，向下给射频进行发送；接收数据时，射频将数据经过解调恢复空<br>中数据上传给基带，基带再对数据进行信道解码，向高层传输。<br>    信道分组编码遵循小端格式。<br>    蓝牙设备地址可以分为三个部分：LAP地位地址（24位）、UAP高位地址（8位）和NAP无效地址部分（16位）；NAP和UAP共同构成了设备的唯一标识符，由SIG的蓝牙地址管理机构分配给各个蓝牙设备制造商。<br>    一个微微网只有一个主设备，一个主设备最多可以同时与7个从设备同时进行通信，这些从化设备称为激活从设备。还可以由隶属与这个微微网中主设备的休眠从设备。休眠从设备不进行数据收发，但是与主设备仍然保持时钟同步。<br>    每个人蓝牙设备都有一个独立运行的内部本地时钟，用于决定收发器的定时和跳频同步。微微网中的定时和跳频选择由主设备的始终决定，建立微微网是，主设备的时钟传送给从设备，每个从设备给自己的本地时钟加一个偏移量，实现与主设备的同步。<br>    蓝牙基带有四个关键周期312.5us、625us、1.25ms和1.28s，主设备发往从设备的数据从偶数时隙开始发送。<br>    CLKN(本地时钟频率）、CLKE（估计时钟频率）CLK（实际运行时钟频率）；CLK和CLKE由CLKN加上一个偏移量得到。<br>#2蓝牙物理链路<br>通信设备之间物理层的数据连接通道就是物理链路。蓝牙系统由两种物理链路：ACLHE SCO。<br>    ACL链路既可以支持异步应用也可以支持同步应用，一对主从舍必只能建立一条ACL链路，ACL链路的通信的可靠性可以由分组重传来保证。<br>    SCO链路数据分组不进行重传操作，一般用于实时性很强的数据传输。只有建立了ACL链路才可以建立SCO链路，一个微微网中的主设备最多可以同时建立三条SCO链路。<br>#3蓝牙基带分组<br>基带分组至少包含接入码（72或68bit），大多情况下还包含分组头（54bit）和有效载荷（0~2745bit）。<br>    接入码用于同步、直流载频泄露偏执补偿和标识。接入码包含引导码（4bit）、同步字（64bit）和尾码（4bit）。<br>    接入码可以分为三类：信道接入码、设备接入码和请求接入码。<br>    引导码用于DC偏置补偿，引导吗只有两种1010和0101，具体取值取决于紧跟的同步字最低位为0（0101）还是1（1010）。<br>    同步字基于对应设备地址的LAP。<br>    尾码取值只有两种，取决于同步字最高位为0（1010）还是为1（0101）.<br>    分组头格式包含如下：<br>    AM_ADDR：3 ：微微网中激活从设备的地址。<br>    TYPE：4 ：分组类型，共有16中。<br>    FLOW：1 ：ACL链路的数据分组的流量控制标志。<br>    ARQN：1 ：无编号自动请求重发。<br>    SEQN：1 ：序列编号，提供了一种防止分组重传的的机制，对于无编号的ARQ特别重要。<br>    HEC：8 ：分组头错误校验。<br>    有效载荷分为语音有效载荷和数据有效载荷。语音有效载荷长度固定，没有有效载荷头；数据有效载荷包括有效载荷头、有效载荷体和CRC校验码。<br>#4蓝牙基带纠错机制<br>蓝牙基带部分提供了三种纠错机制1/3比例FEC、2/3比例FEC和ARQ.<br>#5蓝牙基带逻辑信道<br>链路控制、链路管理、用户异步数据、用户等时数据和用户同步数据信道。<br>#6蓝牙基带收发规则<br>发送规则<br>    主设备为每个从设备准备了一个独立的ACL链路的TX缓冲器，一个或多个SCO链路TX缓冲器。<br>    每个TX缓冲器包括两个先入先出寄存器，这连个缓冲器交替使用实现数据的异步和同步发送。<br>    接收规则<br>    主设备对所有从设备共用一个ACL链路的RX缓冲器，SCO缓冲器的数量取决于实际SCO链路的数量。规则与的发送类似。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-蓝牙射频协议规范" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/14/%E8%93%9D%E7%89%99%E5%B0%84%E9%A2%91%E5%8D%8F%E8%AE%AE%E8%A7%84%E8%8C%83/" class="article-date">
      <time datetime="2018-06-14T13:42:33.000Z" itemprop="datePublished">2018-06-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/14/%E8%93%9D%E7%89%99%E5%B0%84%E9%A2%91%E5%8D%8F%E8%AE%AE%E8%A7%84%E8%8C%83/">蓝牙射频协议规范</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#1.蓝牙射频概述<br>    射频是介于声音与红外线频率之间的电磁波频率。对于无线通信系统而言，射频部分就是通信系统</p>
<p>的“空中接口“，不同厂商的设备要实现兼容或者互操作的基本要求就是射频规范的统一，而且</p>
<p>通信质量也是由射频来决定的。蓝牙射频规范规定了射频频段、调制方式、调频频率、发射功<br>率、接收机灵敏度等参数。<br>##1.频段和信道安排<br>    蓝牙工作在无需许可证的2.4GHz ISM频段上。蓝牙每个频道带宽为1MHz，相邻频道中心频率间隔</p>
<p>为1MHz。为减少带外的辐射和干扰，保留的上下保护频带分别为3.5和2MHz，79个调频频点</p>
<p>中至少有75应该伪随机的进行跳变，在一个30秒的时间段内，任何一个频点的使用时间不得超<br>过0.4秒。<br>##2蓝牙发射器性能<br>    蓝牙设备由3个功率级别，100mW（20dBm)、2.5mW（约4dBm)、1mW（0dBm）。<br>###1.蓝牙射频调制特性<br>    蓝牙射频采用的调制方式是高斯滤波的二进制频移键控，码元带宽积BT为0.5，调制指数h=0.28<del>0.35.<br>###2蓝牙射频的杂散辐射<br>    （1）带内杂散辐射<br>    蓝牙发射器信号必须经过一个频谱整形器，其频谱必须与FCC的20dB带宽定义的一致，并且根据FCC的标准进行测量。<br>    （2）带外杂散辐射<br>    蓝牙射频的带外杂散辐射功率的测试在100KHz上进行。<br>##3.蓝牙接收器性能<br>###1.测试接收器的参靠信号<br>    参考信号围殴GFSK已调信号，调制指数h=0.28</del>0.35，码元带宽积为0.5，比特率为1Mbps，频</p>
<p>率偏移不大于1M,调制序列为伪随机二进制序列PRBS9，干扰调制序列为伪随机二进制序列</p>
<p>PRBS15.<br>###2接收器的实际灵敏度<br>    实际灵敏度为蓝牙通信系统误比特率达到1%是所需的输入电平，蓝牙接收机灵敏度应该优于-70dBM。<br>###3.干扰性能<br>    干扰性能测量条件是：同信道及相邻1MHz、2MHz信道上的信号比参考灵敏度高10dB以上，其他频率时信号比参考灵敏度高3dB。<br>###4.带外截止<br>    带外截止在有用信号超过参考灵敏度信号3dB时进行测量。<br>###5交调特性<br>    参考灵敏度BER=0.1%，应满足频率f0处的有用信号超出参考灵敏度电平6dB；频率f1处使用-39dBm的静态正弦波，频率f2处使用-39dBm的蓝牙已调信号。<br>###6.最大可用电平<br>    最大可用点评应高于-20dBm。<br>###7.杂散辐射<br>    在100kHz带宽上测量杂散辐射功率。<br>###8.接收信号强度指示<br>    通过对接收到的信号与两个门限电平进行比较得到接收信号强度指示（RSSI），在这两个门限值之间是信号的最佳接收范围。<br>#2.蓝牙信道与时隙<br>##1蓝牙物理信道<br>    蓝牙的物理信道是由伪随机序列控制的79个跳频频点构成的，即不同的跳频序列代表着不同的信道。<br>##2.时隙<br>    蓝牙的跳频速率为1600次/s，每个频率的持续时间为625us称为一个时隙。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/%E8%93%9D%E7%89%99/">蓝牙</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-QT添加GPIB驱动库" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/04/25/QT%E6%B7%BB%E5%8A%A0GPIB%E9%A9%B1%E5%8A%A8%E5%BA%93/" class="article-date">
      <time datetime="2018-04-25T15:08:25.000Z" itemprop="datePublished">2018-04-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/25/QT%E6%B7%BB%E5%8A%A0GPIB%E9%A9%B1%E5%8A%A8%E5%BA%93/">QT添加GPIB驱动库</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>第一步安装GPIB卡的驱动，可以安装NI提供的驱动库文件，可以去NI官网查阅<a target="_blank" rel="noopener" href="http://search.ni.com/nisearch/app/main/p/ap/tech/lang/zhs/pg/1/sn/ssnav:ndr/aq/AND%28nicontenttype:driver,%20sitesection:ndr,%20AND%20%28OR%28nigen10:785,%20productcategories:785,%20%22NI-488.2%22%29%20,%20OR%28nilanguage:zh-CN,%20nilanguage:en%29%29%29/">下载安装</a><br>第二步在QT工程中添加GPIB库文件<br>        INCLUDEPATH += “C:\Program Files (x86)\IVI Foundation\VISA\WinNT\Include”<br>        LIBS += “C:\Program Files (x86)\IVI Foundation\VISA\WinNT\lib\msc\visa32.lib”<br>在自己的QT工程中添加这两个文件的路径，确认电脑上有这两个文件。<br>    然后就可以通过NI提供的如下接口：<br>    viOpenDefaultRM（sesn）：打开缺省资源管理器资源对话通道。<br>    viFindRsrc（sesn，expr，findList，retcnt，instrDesc）：查询VISA系统进行资源定位。<br>    viOpen（sesn，rsrcname，accessMode，timeout，vi）：打开特定资源的对话通道。<br>    viWrite（）和viRead（）函数<br>    实现查找电脑上的GPIB设备，并与GPIB设备实现通信的简单任务了。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2020 xianke5200
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
			<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
			<script>
				var now = new Date(); 
				function createtime() { 
					var grt= new Date("10/14/2020 22:15:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
					now.setTime(now.getTime()+250); 
					days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
					hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
					if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
					mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
					seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
					snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
					document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
					document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
				} 
			setInterval("createtime()",250);
			</script>
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >网页到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</footer>

    </div>
    
<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>


<script src="/js/main.js"></script>


    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

<!--动态线条背景-->
<script type="text/javascript"
color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<!--单击显示文字-->
<script type="text/javascript" src="/js/click_show_text.js"></script>

<!--单击烟花效果-->
<canvas %#class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" %#></canvas> 
<script %#type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"%#></script> 
<script %#type="text/javascript" src="/js/fireworks.js"%#></script>